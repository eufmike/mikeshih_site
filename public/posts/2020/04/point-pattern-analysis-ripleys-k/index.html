<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Mike Shih ">
<meta name="description" content="As the usage of Airyscan increases, a type of super-resolution microscopy, more and more researchers are trying to take advantage of its resolution, combined with new organelle markers (MitoTracker or LysoTracker), to extract some information from their geographical distribution. While lacking the tool for spatial analysis, Ripley&amp;rsquo;s K function can come in handy in this type of study. It is a standard geostatistical tool that has been widely used in ecology and geography." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2020/04/point-pattern-analysis-ripleys-k/" />


    <title>
        
            Point Pattern Analysis (Ripley&#39;s K) :: Mike Shih  — Data Scientist
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.84ed5579024525d4b50458514d1a43e40dd5272df45c7cd6da85b225af457154.css">




<meta itemprop="name" content="Point Pattern Analysis (Ripley&#39;s K)">
<meta itemprop="description" content="As the usage of Airyscan increases, a type of super-resolution microscopy, more and more researchers are trying to take advantage of its resolution, combined with new organelle markers (MitoTracker or LysoTracker), to extract some information from their geographical distribution. While lacking the tool for spatial analysis, Ripley&rsquo;s K function can come in handy in this type of study. It is a standard geostatistical tool that has been widely used in ecology and geography.">
<meta itemprop="datePublished" content="2020-04-14T14:44:08-05:00" />
<meta itemprop="dateModified" content="2020-04-14T14:44:08-05:00" />
<meta itemprop="wordCount" content="1007">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="" /><meta property="og:title" content="Point Pattern Analysis (Ripley&#39;s K)" />
<meta property="og:description" content="As the usage of Airyscan increases, a type of super-resolution microscopy, more and more researchers are trying to take advantage of its resolution, combined with new organelle markers (MitoTracker or LysoTracker), to extract some information from their geographical distribution. While lacking the tool for spatial analysis, Ripley&rsquo;s K function can come in handy in this type of study. It is a standard geostatistical tool that has been widely used in ecology and geography." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/04/point-pattern-analysis-ripleys-k/" />
<meta property="og:image" content="/"/>
<meta property="article:published_time" content="2020-04-14T14:44:08-05:00" />
<meta property="article:modified_time" content="2020-04-14T14:44:08-05:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Point Pattern Analysis (Ripley&#39;s K)"/>
<meta name="twitter:description" content="As the usage of Airyscan increases, a type of super-resolution microscopy, more and more researchers are trying to take advantage of its resolution, combined with new organelle markers (MitoTracker or LysoTracker), to extract some information from their geographical distribution. While lacking the tool for spatial analysis, Ripley&rsquo;s K function can come in handy in this type of study. It is a standard geostatistical tool that has been widely used in ecology and geography."/>





    <meta property="article:published_time" content="2020-04-14 14:44:08 -0500 CDT" />









<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>
    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">Home</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner">
        
        <li><a href="/about/">About</a></li><li><a href="/posts/">Posts</a></li>
        
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>5 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="/posts/2020/04/point-pattern-analysis-ripleys-k/">Point Pattern Analysis (Ripley&rsquo;s K)</a>
            </h1>

            

            <div class="post-content">
                <p>As the usage of Airyscan increases, a type of super-resolution microscopy, more and more researchers are trying to take advantage of its resolution, combined with new organelle markers (MitoTracker or LysoTracker), to extract some information from their geographical distribution. While lacking the tool for spatial analysis, Ripley&rsquo;s K function can come in handy in this type of study. It is a standard geostatistical tool that has been widely used in ecology and geography. Despite being a stranger to most biologists, Ripley&rsquo;s K function and its derivatives are quite popular for analyzing data collected from Single-Molecule localization Microscopies (SMLM), such as stochastic optical reconstruction microscopy (STORM) or photoactivated localization microscopy (PALM). Interestingly, Ripley&rsquo;s K function was originally developed for Dr. Francis Crick&rsquo;s challenge of measuring cell clustering. It will be nice to see it finds its way home.</p>
<h1 id="point-patterns-testing-note">Point Patterns: testing note</h1>
<h6 id="tags-notecodingr-notewuccistorm">tags: note/coding/r, note/wucci/STORM</h6>
<h2 id="getis--franklins-point-pattern-analysis">Getis &amp; Franklin’s point pattern analysis</h2>
<p>Second-Order Neighborhood Analysis</p>
<h3 id="background">Background</h3>
<ul>
<li>This note documents materials required for Getis &amp; Franklin’s point pattern analysis. This method has been used in several papers to describe and create density map for STORM dataset.</li>
<li>The analytic method was originally published in 1987 on <em>Ecology</em>, and later reprinted in the book titled ”<em>Perspectives on Spatial Data Analysis</em>”.</li>
<li>The incentive of building this method, was to provide a tool for ecologists and geographers, to quantify targets with flexibility in scale.</li>
<li>It was designed for a remote sensing study of canopy reflectance for a ponderosa pine (<em>Pinus ponderosa</em>) forest.</li>
<li>People used to call the method Getis &amp; Franklin’s method, but its actual name is “Second-Order Neighborhood Analysis”.</li>
</ul>
<h3 id="note">Note</h3>
<ul>
<li>“Perhaps blocking, or contiguous quadrat analysis, is the most common method used for examining grain of pattern.”</li>
</ul>
<h4 id="contiguous-quadrat-analysis">Contiguous quadrat analysis</h4>
<p>Quadrat (樣方，方區): A quadrat is a frame, traditionally square, used in ecology and geography to isolate a standard unit of area for study of the distribution of an item over a large area.
<a href="https://www.omicsonline.org/cmeias-quadrat-maker-a-digital-software-tool-to-optimize-grid-2157-7625.1000136.php?aid=18461">Example for contiguous quadrat analysis</a>
<img src="https://i.imgur.com/sHvcY6N.png" alt=""></p>
<h4 id="spectral-analysis">Spectral analysis</h4>
<p><a href="https://en.wikipedia.org/wiki/Spectral_density_estimation">Spectral density estimation - Wikipedia</a>
<a href="https://en.wikipedia.org/wiki/Kernel_density_estimation">Kernel density estimation - Wikipedia</a></p>
<h4 id="the-model">The model</h4>
<p>$$
\hat{L}<em>i(d)= \Biggl[A\sum</em>{j=1}^n\frac{K_{ij}}{\pi(n-1)}\Biggr]^\frac{1}{2}
$$</p>
<p>This function is an modified function from Ripley&rsquo;s K, and returns  $\hat{L}_i(d)$ for individual points.</p>
<p><img src="https://i.imgur.com/e3HzTA0.png" alt=""></p>
<p>By plotting each point with its value in isoline, these are the plot:
<img src="https://i.imgur.com/uwiD1uP.png" alt=""></p>
<h3 id="compare-getis-and-franklins-function-with-ripleys-k-function">Compare Getis and Franklin&rsquo;s Function with Ripley&rsquo;s K Function</h3>
<h4 id="getis-and-franklins-function">Getis and Franklin&rsquo;s Function</h4>
<p>$$
\hat{L}<em>i(d)= \Biggl[A\sum</em>{j=1}^n\frac{K_{ij}}{\pi(n-1)}\Biggr]^\frac{1}{2}
$$</p>
<p>$K_{ij}$: If for a given neighborhood point j the specified distance d is more than the distance between i and j, then the pair (kij ) counts as 1 (unless the boundary correction is required); otherwise kij counts 0.</p>
<p>Edge correction:</p>
<ul>
<li>if the distance of between $i$ and $j$ is greater than the distance between $i$ and the nearest boundary:</li>
</ul>
<p>$$K_{ij} = \biggl[1-\frac{\cos^{-1}(\frac{e_1}{d})}{\pi}\biggr]^{-1}$$</p>
<ul>
<li>if the distance of between $i$ and $j$ is greater than the distance to both of two boundaries $(e_1, e_2)$, use:</li>
</ul>
<p>$$K_{ij} = \biggl{1-\frac{\cos^{-1}(\frac{e_1}{d}+\cos^{-1}(\frac{e_2}{d})+\frac{\pi}{2} )}{2\pi}\biggr}^{-1}$$</p>
<h4 id="ripleys-k-function">Ripley&rsquo;s K Function</h4>
<p>$$
\hat{K}(d)= \hat{\lambda}^{-1}\sum_{i}\sum_{j\neq1}\frac{\omega(l_i, l_j)I(d_{ij&lt;t})}{N}
$$</p>
<p>Edge correction is controlled by $\omega$</p>
<p>Note: These two functions are similar because $K_{ij}$ and $I(d_{ij&lt;t})$ are  the same.</p>
<ul>
<li>
<p>In Ripley&rsquo;s K funtion, if the first sigma is ignored, it can also return $\hat{K}(d)$ for each spot with doing averaging. $\hat{\lambda}^{-1}$ is the estimated density, so it equals to ${A}/{N}$. When it describes a single spot, $N$ = 1.</p>
</li>
<li>
<p>In G&amp;F&rsquo;s funtion, $\pi$ can be moved outside the sigma because it is a constant.</p>
</li>
</ul>
<p>Which means, when we describe a single spot without edge correction, Getis and Franklin&rsquo;s Function looks like this:
$$
\hat{L}<em>i(d)= \Biggl[\frac{A}{\pi}\sum</em>{j=1}^n\frac{K_{ij}}{(n-1)}\Biggr]^\frac{1}{2}
$$</p>
<p>Ripley&rsquo;s K Function looks like this:
$$
\hat{K}<em>i(d)= A\sum</em>{j\neq1}\frac{I(d_{ij&lt;t})}{N}
$$</p>
<p>Since $$\sum_{j=1}^n\frac{1}{(n-1)}$$</p>
<p>and $$\sum_{j\neq1}\frac{1}{N}$$</p>
<p>are the same, it is not hard to find that G&amp;F&rsquo;s function is just a type of Ripley&rsquo;s K Function but divided by $\pi$ and sqare rooted, in order to keep the data linear. Getis&rsquo;s method is</p>
<h3 id="code-in-r">Code in R</h3>
<p>In R, we can use the <code>localL</code> funtion in <code>spatstat</code> to achive Getis&rsquo;s method. The problem is <code>localL</code> forces to run through the whole dataset. It is less flexible, and took significantly amount of time to run through hundred thousand of points.</p>
<h3 id="code-in-python">Code in Python</h3>
<p>Rethink the code I have.</p>
<pre><code>
file	time	version
0	P_ThomasPP_20	0.393422	ripleyk_v2
1	P_ThomasPP_20	1.751421	ripleyk_v3
2	P_ThomasPP_20	0.397242	ripleyk_v4
3	P_ThomasPP_256	891.318586	ripleyk_v4
4	P_ThomasPP_256	883.690282	ripleyk_v2
</code></pre><h3 id="reference">Reference</h3>
<ul>
<li>
<p>Williamson, D. J., Owen, D. M., Rossy, J., Magenau, A., Wehrmann, M., Gooding, J. J., &amp; Gaus, K. (2011). Pre-existing clusters of the adaptor Lat do not participate in early T cell signaling events. <em>Nature Immunology</em>, <em>12</em>(7), 655–662. <a href="http://doi.org/10.1038/ni.2049">http://doi.org/10.1038/ni.2049</a>
<a href="papers3://publication/doi/10.1038/ni.2049">Link to my paper3 database</a></p>
</li>
<li>
<p>Bálint, Š., Lopes, F. B., &amp; Davis, D. M. (2018). A nanoscale reorganization of the IL-15 receptor is triggered by NKG2D in a ligand-dependent manner. <em>Science Signaling</em>, <em>11</em>(525), eaal3606. <a href="http://doi.org/10.1126/scisignal.aal3606">http://doi.org/10.1126/scisignal.aal3606</a>
<a href="papers3://publication/doi/10.1126/scisignal.aal3606">Link to my paper3 database</a></p>
</li>
<li>
<p>Ripley, B. D. (1977). Modelling spatial patterns (with discussion). JR Statist. Soc. B, 39, 172-212.(1981) Spatial Statistics.
<a href="papers3://publication/uuid/45A4FFCA-990E-4FEE-B12E-4456C3C3653C">Link to my paper3 database</a></p>
</li>
<li>
<p>Getis, A. (1984). Interaction Modeling Using Second-Order Analysis. Environment and Planning A, 16(2), 173–183. <a href="http://doi.org/10.1068/a160173">http://doi.org/10.1068/a160173</a>
<a href="papers3://publication/doi/10.1068/a160173">Link to my paper3 database</a></p>
</li>
<li>
<p>Getis, A., Franklin, J. (1987) Second-Order Neighborhood Analysis of Mapped Point Patterns. Ecology 68:473-477. Reprinted with permission of The Ecological Society of America, Washington DC
<a href="papers3://publication/doi/10.1007/978-3-642-01976-0_7">Link to my paper3 database</a></p>
</li>
<li>
<p>Getis, A., &amp; Franklin, J. (2008). Second-Order Neighborhood Analysis of Mapped Point Patterns. In <em>Perspectives on Spatial Data Analysis</em> (pp. 93–100). Berlin, Heidelberg: Springer Berlin Heidelberg. <a href="http://doi.org/10.1007/978-3-642-01976-0_7">http://doi.org/10.1007/978-3-642-01976-0_7</a>
<a href="papers3://publication/uuid/D2CC985A-F970-4E38-A220-C5EE00E1B5FA">Link to my paper3 database</a></p>
</li>
</ul>
<h2 id="book--other-resource">Book &amp; Other Resource</h2>
<p>Books for Spatial statistics</p>
<ul>
<li><a href="https://gis.stackexchange.com/questions/48754/learning-spatial-statistics">references - Learning Spatial Statistics? - Geographic Information Systems Stack Exchange</a></li>
<li>R code: <a href="http://rstudio-pubs-static.s3.amazonaws.com/5292_2b2fae3795a144b2a4b486fd2fc6fc57.html">Point Patterns: Hypothesis Testing</a></li>
<li>MATLAB tool:  <a href="https://github.com/quokka79/ClusterFields">GitHub - quokka79/ClusterFields: Getis &amp; Franklin Local Point Pattern Analysis for Localisation Microscopy Images</a></li>
</ul>
<h2 id="statistical-concepts">Statistical Concepts</h2>
<h3 id="the-order-statistic">The order statistic</h3>
<p>不是很容易找到有關定義Order Statistics的資料，無法確定是個慣用法還是有明確的出處。基本上1st跟2nd order statistics指的是first and second moments，包含arithmetic mean（算術平均數）跟variance（變異數）。
<a href="http://www1.maths.leeds.ac.uk/applied/news.dir/issue2/hos_intro.html">Introducing Higher Order Statistics (HOS)</a></p>
<p>moment <a href="https://zh.wikipedia.org/wiki/%E7%9F%A9_(%E6%95%B8%E5%AD%B8)">矩</a>
<a href="https://en.wikipedia.org/wiki/Moment_(mathematics)">Moment (mathematics) - Wikipedia</a></p>
<p>Statistical dispersion（離散程度）</p>
<h2 id="edge-correction">Edge Correction</h2>
<p>orrection=c(&ldquo;border&rdquo;, &ldquo;isotropic&rdquo;, &ldquo;Ripley&rdquo;, &ldquo;translate&rdquo;)</p>
<p>Ripley:</p>
<p>border:</p>
<h3 id="interpolation">Interpolation</h3>
<p>matlab: v4
biharmonic spline interpolation
<a href="https://www.mathworks.com/help/curvefit/interpolation-methods.html">https://www.mathworks.com/help/curvefit/interpolation-methods.html</a>
<a href="http://www.fon.hum.uva.nl/praat/manual/biharmonic_spline_interpolation.html">http://www.fon.hum.uva.nl/praat/manual/biharmonic_spline_interpolation.html</a>
Someone suggest this method for python:
<a href="https://mail.python.org/pipermail/scipy-dev/2014-July/019952.html">https://mail.python.org/pipermail/scipy-dev/2014-July/019952.html</a>
<a href="https://scipy.github.io/old-wiki/pages/Cookbook/RadialBasisFunctions.html">https://scipy.github.io/old-wiki/pages/Cookbook/RadialBasisFunctions.html</a></p>
<h2 id="ripleys-k-function-and-derivative">Ripley&rsquo;s K Function and derivative</h2>
<ol>
<li>Ripley&rsquo;s K-function
$$
\hat{K}(r)= \hat{\lambda}^{-1}\sum_{i}\sum_{j\neq1}\frac{\omega(l_i, l_j)I(d_{ij&lt;r})}{N}
$$</li>
<li>L-function: a normalization proposed by Besag
$$
\hat{L}(r)=\sqrt{\frac{\hat{K}(r)}{\pi}}
$$</li>
<li>H-function: also called $L(r)-r$
$$
\hat{H}(r)=
$$</li>
</ol>

            </div>
        </article>

        <hr />

        <div class="post-info">

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1007 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-04-14 14:44 -0500</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="/posts/2020/04/density-plot/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Density Plot</span>
                            </a>
                        </span>
                    

                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="/">Mike Shih</a></span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>



    </body>
</html>
